# AWS S3 Integration Architecture

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CCTV Recording System                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CCTV Cameras   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Local Client    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Django Backend  â”‚
â”‚                  â”‚  RTSP   â”‚  (Recording)     â”‚   API   â”‚                  â”‚
â”‚  â€¢ Camera 1      â”‚         â”‚                  â”‚         â”‚  â€¢ API Server    â”‚
â”‚  â€¢ Camera 2      â”‚         â”‚  â€¢ Captures      â”‚         â”‚  â€¢ Database      â”‚
â”‚  â€¢ Camera 3      â”‚         â”‚  â€¢ Encodes       â”‚         â”‚  â€¢ Management    â”‚
â”‚  â€¢ ...           â”‚         â”‚  â€¢ Stores Local  â”‚         â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚                            â”‚
                                      â”‚ Upload                     â”‚ Upload
                                      â–¼                            â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚          AWS S3 Bucket                  â”‚
                            â”‚                                         â”‚
                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                            â”‚  â”‚   recordings/                     â”‚ â”‚
                            â”‚  â”‚   â”œâ”€â”€ camera-1/                   â”‚ â”‚
                            â”‚  â”‚   â”‚   â”œâ”€â”€ 2024-11-01/            â”‚ â”‚
                            â”‚  â”‚   â”‚   â”‚   â”œâ”€â”€ video1.mp4         â”‚ â”‚
                            â”‚  â”‚   â”‚   â”‚   â””â”€â”€ video2.mp4         â”‚ â”‚
                            â”‚  â”‚   â”‚   â””â”€â”€ 2024-11-02/            â”‚ â”‚
                            â”‚  â”‚   â”œâ”€â”€ camera-2/                   â”‚ â”‚
                            â”‚  â”‚   â””â”€â”€ camera-3/                   â”‚ â”‚
                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ Presigned URLs
                                      â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   End Users         â”‚
                            â”‚  â€¢ Web App          â”‚
                            â”‚  â€¢ Mobile App       â”‚
                            â”‚  â€¢ Admin Panel      â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Video Upload Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Video Upload Process                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. RECORDING STARTS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Camera Stream   â”‚
   â”‚  (RTSP)          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Local Client    â”‚
   â”‚  â€¢ FFmpeg        â”‚
   â”‚  â€¢ Encodes H.264 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Local Storage   â”‚
   â”‚  ./recordings/   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. RECORDING COMPLETE
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Upload Manager              â”‚
   â”‚  â€¢ Detects new file          â”‚
   â”‚  â€¢ Validates file            â”‚
   â”‚  â€¢ Prepares metadata         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  S3Uploader.upload_file()    â”‚
   â”‚  â€¢ boto3.upload_file()       â”‚
   â”‚  â€¢ Multipart for large files â”‚
   â”‚  â€¢ Retry on failure          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  AWS S3 Bucket               â”‚
   â”‚  â€¢ Encrypted storage         â”‚
   â”‚  â€¢ Private access            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. CLEANUP (Optional)
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Delete Local File           â”‚
   â”‚  (if cleanup enabled)        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. DATABASE UPDATE
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Update Recording Model      â”‚
   â”‚  â€¢ Save S3 URL               â”‚
   â”‚  â€¢ Update status             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ S3 Bucket Structure

```
cctv-footage-bucket (S3 Bucket)
â”‚
â”œâ”€â”€ recordings/                    # Main recordings folder
â”‚   â”œâ”€â”€ camera-123/               # Camera ID
â”‚   â”‚   â”œâ”€â”€ 2024-11-01/          # Date
â”‚   â”‚   â”‚   â”œâ”€â”€ recording_08_00_00.mp4
â”‚   â”‚   â”‚   â”œâ”€â”€ recording_08_30_00.mp4
â”‚   â”‚   â”‚   â””â”€â”€ recording_09_00_00.mp4
â”‚   â”‚   â”œâ”€â”€ 2024-11-02/
â”‚   â”‚   â”‚   â”œâ”€â”€ recording_08_00_00.mp4
â”‚   â”‚   â”‚   â””â”€â”€ recording_08_30_00.mp4
â”‚   â”‚   â””â”€â”€ 2024-11-03/
â”‚   â”‚
â”‚   â”œâ”€â”€ camera-456/
â”‚   â”‚   â”œâ”€â”€ 2024-11-01/
â”‚   â”‚   â””â”€â”€ 2024-11-02/
â”‚   â”‚
â”‚   â””â”€â”€ camera-789/
â”‚
â”œâ”€â”€ media/                         # Additional media files
â”‚   â”œâ”€â”€ thumbnails/               # Video thumbnails
â”‚   â”œâ”€â”€ snapshots/                # Camera snapshots
â”‚   â””â”€â”€ logs/                     # Log files
â”‚
â””â”€â”€ test/                          # Test files
    â””â”€â”€ connection_test.txt
```

---

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Security Layers                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. AWS IAM Security
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  IAM User                    â”‚
   â”‚  â€¢ Access Key ID             â”‚
   â”‚  â€¢ Secret Access Key         â”‚
   â”‚  â€¢ Minimal permissions only  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  IAM Policy                  â”‚
   â”‚  â€¢ Bucket-specific           â”‚
   â”‚  â€¢ Action-specific           â”‚
   â”‚  â€¢ No wildcard permissions   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. S3 Bucket Security
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Block Public Access         â”‚
   â”‚  â€¢ All public access blocked â”‚
   â”‚  â€¢ Private by default        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Server-Side Encryption      â”‚
   â”‚  â€¢ SSE-S3 or SSE-KMS         â”‚
   â”‚  â€¢ Encrypted at rest         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. Application Security
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Environment Variables       â”‚
   â”‚  â€¢ .env file (not in git)    â”‚
   â”‚  â€¢ Secrets in env vars       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Presigned URLs              â”‚
   â”‚  â€¢ Temporary access          â”‚
   â”‚  â€¢ Time-limited              â”‚
   â”‚  â€¢ Automatic expiration      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. Network Security
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  HTTPS/TLS Only              â”‚
   â”‚  â€¢ All transfers encrypted   â”‚
   â”‚  â€¢ No plain HTTP             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Complete Data Flow                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   [CCTV Camera]
        â”‚
        â”‚ RTSP Stream
        â–¼
   [Local Client]
        â”‚
        â”œâ”€â”€â”€ Encode video (FFmpeg)
        â”‚
        â”œâ”€â”€â”€ Save locally (./recordings/)
        â”‚
        â”œâ”€â”€â”€ Register with backend API
        â”‚         â”‚
        â”‚         â–¼
        â”‚    [Django Backend]
        â”‚         â”‚
        â”‚         â””â”€â”€â”€ Create Recording entry in DB
        â”‚
        â”œâ”€â”€â”€ Upload to S3
        â”‚         â”‚
        â”‚         â”œâ”€â”€â”€ Prepare metadata
        â”‚         â”œâ”€â”€â”€ boto3.upload_file()
        â”‚         â”‚         â”‚
        â”‚         â”‚         â–¼
        â”‚         â”‚    [AWS S3 Bucket]
        â”‚         â”‚         â”‚
        â”‚         â”‚         â”œâ”€â”€â”€ Store encrypted
        â”‚         â”‚         â””â”€â”€â”€ Return S3 URL
        â”‚         â”‚
        â”‚         â””â”€â”€â”€ Update Recording in DB with S3 URL
        â”‚
        â””â”€â”€â”€ Cleanup local file (optional)


   [End User Request]
        â”‚
        â”‚ Request video playback
        â–¼
   [Django Backend]
        â”‚
        â”œâ”€â”€â”€ Query Recording from DB
        â”‚
        â”œâ”€â”€â”€ Generate presigned URL
        â”‚         â”‚
        â”‚         â–¼
        â”‚    [S3Uploader.generate_presigned_url()]
        â”‚         â”‚
        â”‚         â””â”€â”€â”€ Returns temporary signed URL
        â”‚
        â””â”€â”€â”€ Return URL to user
                  â”‚
                  â–¼
              [End User]
                  â”‚
                  â”‚ Direct request to S3
                  â–¼
              [AWS S3]
                  â”‚
                  â””â”€â”€â”€ Stream video (if URL valid)
```

---

## ğŸ”§ Component Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Component Relationships                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   settings.py       â”‚  â—„â”€â”€â”€ Loads from .env
â”‚   â€¢ AWS config      â”‚
â”‚   â€¢ Credentials     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Imports
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  config.py          â”‚  â—„â”€â”€â”€ Local client config
â”‚  (local_client)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Used by
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  s3_uploader.py     â”‚  â—„â”€â”€â”€ Main S3 utility
â”‚  â€¢ S3Uploader class â”‚
â”‚  â€¢ Helper functions â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Uses
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  boto3              â”‚  â—„â”€â”€â”€ AWS SDK
â”‚  â€¢ s3_client        â”‚
â”‚  â€¢ upload/download  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Connects to
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AWS S3 API         â”‚
â”‚  â€¢ REST API         â”‚
â”‚  â€¢ HTTPS            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Database Schema (Recording Model)

```python
# Suggested Recording model structure

class Recording(models.Model):
    id = models.UUIDField(primary_key=True)
    camera = models.ForeignKey(Camera)
    
    # File information
    filename = models.CharField(max_length=255)
    file_size = models.BigIntegerField()  # bytes
    duration = models.IntegerField()  # seconds
    
    # Timestamps
    recording_started_at = models.DateTimeField()
    recording_ended_at = models.DateTimeField()
    created_at = models.DateTimeField(auto_now_add=True)
    
    # Storage information
    storage_backend = models.CharField(
        max_length=10,
        choices=[('AWS', 'AWS S3'), ('GCP', 'Google Cloud Storage')]
    )
    
    # AWS S3 specific
    s3_bucket = models.CharField(max_length=255, blank=True)
    s3_key = models.CharField(max_length=500, blank=True)
    s3_region = models.CharField(max_length=50, blank=True)
    
    # GCP specific (for backward compatibility)
    gcp_bucket = models.CharField(max_length=255, blank=True)
    gcp_blob_name = models.CharField(max_length=500, blank=True)
    
    # Status
    status = models.CharField(
        max_length=20,
        choices=[
            ('recording', 'Recording'),
            ('uploading', 'Uploading'),
            ('completed', 'Completed'),
            ('failed', 'Failed')
        ]
    )
    
    def get_signed_url(self, expiration=7200):
        """Get presigned URL for video access"""
        if self.storage_backend == 'AWS':
            from utils.s3_uploader import get_recording_url
            return get_recording_url(self.s3_key, expiration)
        elif self.storage_backend == 'GCP':
            # GCP implementation
            pass
```

---

## ğŸš€ Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Production Deployment                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Load Balancer   â”‚  â—„â”€â”€â”€ HTTPS traffic
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Django Backend  â”‚
â”‚  â€¢ EC2 / ECS     â”‚  â—„â”€â”€â”€ Use IAM Role (no keys needed)
â”‚  â€¢ Gunicorn      â”‚
â”‚  â€¢ Nginx         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚
         â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RDS Database    â”‚  â”‚  AWS S3          â”‚
â”‚  â€¢ PostgreSQL    â”‚  â”‚  â€¢ Videos        â”‚
â”‚  â€¢ Multi-AZ      â”‚  â”‚  â€¢ Encrypted     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


On-Premises:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Local Client    â”‚  â—„â”€â”€â”€ Uses Access Keys (secure .env)
â”‚  â€¢ Recording     â”‚
â”‚  â€¢ Upload        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ VPN / Direct Connect (optional)
         â–¼
    AWS Cloud
```

---

## ğŸ“Š Monitoring & Logging

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Monitoring Architecture                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Application Logs
       â”‚
       â”œâ”€â”€â”€ Django logging
       â”‚         â”‚
       â”‚         â–¼
       â”‚    [CloudWatch Logs]
       â”‚
       â””â”€â”€â”€ S3 access logs
                 â”‚
                 â–¼
            [S3 Access Logging]


AWS Monitoring
       â”‚
       â”œâ”€â”€â”€ S3 Metrics
       â”‚         â”‚
       â”‚         â”œâ”€â”€â”€ Bucket size
       â”‚         â”œâ”€â”€â”€ Request count
       â”‚         â””â”€â”€â”€ Error rate
       â”‚
       â”œâ”€â”€â”€ Cost Explorer
       â”‚         â”‚
       â”‚         â””â”€â”€â”€ Daily/Monthly costs
       â”‚
       â””â”€â”€â”€ CloudWatch Alarms
                 â”‚
                 â”œâ”€â”€â”€ High request rate
                 â”œâ”€â”€â”€ Failed uploads
                 â””â”€â”€â”€ Cost threshold
```

---

## ğŸ”„ Lifecycle Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    S3 Lifecycle Policy                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Day 0-7:
   [S3 Standard]
   â€¢ Frequent access
   â€¢ Full speed
   â€¢ $0.023/GB/month
        â”‚
        â–¼
Day 8-30:
   [S3 Intelligent-Tiering]
   â€¢ Auto optimization
   â€¢ $0.023/GB/month (frequent)
   â€¢ $0.0125/GB/month (infrequent)
        â”‚
        â–¼
Day 31-90:
   [S3 Glacier Instant Retrieval]
   â€¢ Rarely accessed
   â€¢ Millisecond retrieval
   â€¢ $0.004/GB/month (75% cheaper!)
        â”‚
        â–¼
Day 91+:
   [S3 Glacier Deep Archive]
   â€¢ Long-term archive
   â€¢ 12-hour retrieval
   â€¢ $0.00099/GB/month (96% cheaper!)
        â”‚
        â–¼
After 365 days:
   [Delete]
   â€¢ Automatic deletion
   â€¢ Free up space
```

---

## ğŸ¯ Best Practices Summary

1. **Security**
   - Use IAM roles on EC2 (no keys)
   - Rotate keys every 90 days
   - Enable MFA on AWS account
   - Use bucket policies + IAM policies

2. **Cost Optimization**
   - Implement lifecycle policies
   - Use S3 Intelligent-Tiering
   - Delete old recordings
   - Monitor costs daily

3. **Performance**
   - Use multipart upload (boto3 does this)
   - Enable S3 Transfer Acceleration (if needed)
   - Choose nearest region
   - Use CloudFront for distribution

4. **Reliability**
   - Enable versioning (optional)
   - Use Multi-AZ buckets
   - Implement retry logic
   - Monitor upload failures

5. **Monitoring**
   - Set up CloudWatch alarms
   - Enable S3 access logging
   - Track upload/download metrics
   - Review costs weekly

---

**Document Version**: 1.0  
**Last Updated**: November 2, 2024

